<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Start VNC Browsing Agent</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #streamOutput { white-space: pre-line; border:1px solid #ccc; padding:10px; height:300px; overflow-y:auto; }
  button { padding:10px 20px; font-size:16px; }
  textarea { width:100%; padding:8px; margin:10px 0; }
</style>
</head>
<body>
  <h1>Start VNC Browsing Agent</h1>
  <form id="taskForm">
    <label for="task">Enter task description:</label>
    <textarea id="task" name="task" rows="4" placeholder="Describe the browsing task..."></textarea>
    <button type="submit">Start Session & Stream</button>
  </form>

  <div id="vncButtonContainer" style="margin-top:20px;"></div>
  <div id="streamOutput"></div>

<script>
const vercelAgentUrl = 'https://vercel-agents.vercel.app/browser_agent';
const proxyBase = 'http://cuak-v1-stickiness-balancer-871735130.us-east-1.elb.amazonaws.com/vnc-proxy';

document.getElementById('taskForm').addEventListener('submit', async e => {
  e.preventDefault();
  document.getElementById('vncButtonContainer').innerHTML = '';
  document.getElementById('streamOutput').textContent = 'Starting sessionâ€¦\n';

  const resp = await fetch(vercelAgentUrl, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      protocol:'data',
      task: document.getElementById('task').value,
      user_context:''
    })
  });

  const reader = resp.body.getReader();
  const decoder = new TextDecoder();
  let buffer = '', stickiness=null, vncUrl=null;

  while(true){
    const {done, value} = await reader.read();
    if(done) break;
    const chunk = decoder.decode(value);
    document.getElementById('streamOutput').textContent += chunk;
    buffer += chunk;

    const lines = buffer.split('\n');
    buffer = lines.pop();

    for(const line of lines){
      if(line.includes('SESSION_STICKINESS:')){
        stickiness = line.split('SESSION_STICKINESS:')[1].trim();
      }
      if(line.includes('VNC_URL:')){
        vncUrl = line.split('VNC_URL:')[1].trim();
        const sessionId = vncUrl.split('/vnc/')[1];
        const iframeSrc = `${proxyBase}/${sessionId}?session_stickiness=${encodeURIComponent(stickiness)}`;
        document.getElementById('vncButtonContainer').innerHTML =
          `<iframe src="${iframeSrc}" width="100%" height="700px" frameborder="0"></iframe>`;
      }
    }
  }
});
</script>
</body>
</html>






